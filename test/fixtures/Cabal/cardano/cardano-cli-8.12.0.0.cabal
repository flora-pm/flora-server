cabal-version: 3.4

name:                   cardano-cli
version:                8.12.0.0
synopsis:               The Cardano command-line interface
description:            The Cardano command-line interface.
copyright:              2020-2023 Input Output Global Inc (IOG).
author:                 IOHK
maintainer:             operations@iohk.io
category:               Cardano,
                        CLI,
license:                Apache-2.0
license-files:          LICENSE
                        NOTICE
build-type:             Simple
extra-source-files:     README.md

Flag unexpected_thunks
  Description:          Turn on unexpected thunks checks
  Default:              False

common project-config
  default-language:     Haskell2010

  default-extensions:   OverloadedStrings
  build-depends:        base >= 4.14 && < 4.19

  ghc-options:          -Wall
                        -Wcompat
                        -Wincomplete-record-updates
                        -Wincomplete-uni-patterns
                        -Wno-unticked-promoted-constructors
                        -Wpartial-fields
                        -Wredundant-constraints

  if impl(ghc >= 9.6)
    ghc-options:        -Wunused-packages

common maybe-unix
  if !os(windows)
     build-depends:     unix

common maybe-bytestring
  if !os(windows)
     build-depends:     bytestring

library
  import:               project-config
                      , maybe-unix

  if flag(unexpected_thunks)
    cpp-options:        -DUNEXPECTED_THUNKS

  if impl(ghc < 9.6)
    ghc-options:        -Wno-redundant-constraints

  hs-source-dirs:       src

  exposed-modules:      Cardano.CLI.Byron.Commands
                        Cardano.CLI.Byron.Delegation
                        Cardano.CLI.Byron.Genesis
                        Cardano.CLI.Byron.Key
                        Cardano.CLI.Byron.Legacy
                        Cardano.CLI.Byron.Parsers
                        Cardano.CLI.Byron.Query
                        Cardano.CLI.Byron.Run
                        Cardano.CLI.Byron.Tx
                        Cardano.CLI.Byron.UpdateProposal
                        Cardano.CLI.Byron.Vote
                        Cardano.CLI.Environment
                        Cardano.CLI.EraBased.Commands
                        Cardano.CLI.EraBased.Commands.Address
                        Cardano.CLI.EraBased.Commands.Genesis
                        Cardano.CLI.EraBased.Commands.Governance
                        Cardano.CLI.EraBased.Commands.Governance.Actions
                        Cardano.CLI.EraBased.Commands.Governance.Committee
                        Cardano.CLI.EraBased.Commands.Governance.DRep
                        Cardano.CLI.EraBased.Commands.Governance.Poll
                        Cardano.CLI.EraBased.Commands.Governance.Query
                        Cardano.CLI.EraBased.Commands.Governance.Vote
                        Cardano.CLI.EraBased.Commands.Key
                        Cardano.CLI.EraBased.Commands.Node
                        Cardano.CLI.EraBased.Commands.Query
                        Cardano.CLI.EraBased.Commands.StakeAddress
                        Cardano.CLI.EraBased.Commands.StakePool
                        Cardano.CLI.EraBased.Commands.TextView
                        Cardano.CLI.EraBased.Commands.Transaction
                        Cardano.CLI.EraBased.Options.Address
                        Cardano.CLI.EraBased.Options.Common
                        Cardano.CLI.EraBased.Options.Genesis
                        Cardano.CLI.EraBased.Options.Governance
                        Cardano.CLI.EraBased.Options.Governance.Actions
                        Cardano.CLI.EraBased.Options.Governance.Committee
                        Cardano.CLI.EraBased.Options.Governance.DRep
                        Cardano.CLI.EraBased.Options.Governance.Poll
                        Cardano.CLI.EraBased.Options.Governance.Query
                        Cardano.CLI.EraBased.Options.Governance.Vote
                        Cardano.CLI.EraBased.Options.Key
                        Cardano.CLI.EraBased.Options.Node
                        Cardano.CLI.EraBased.Options.Query
                        Cardano.CLI.EraBased.Options.StakeAddress
                        Cardano.CLI.EraBased.Options.StakePool
                        Cardano.CLI.EraBased.Options.TextView
                        Cardano.CLI.EraBased.Options.Transaction
                        Cardano.CLI.EraBased.Run
                        Cardano.CLI.EraBased.Run.Address
                        Cardano.CLI.EraBased.Run.Address.Info
                        Cardano.CLI.EraBased.Run.Genesis
                        Cardano.CLI.EraBased.Run.Governance
                        Cardano.CLI.EraBased.Run.Governance.Actions
                        Cardano.CLI.EraBased.Run.Governance.Committee
                        Cardano.CLI.EraBased.Run.Governance.DRep
                        Cardano.CLI.EraBased.Run.Governance.Poll
                        Cardano.CLI.EraBased.Run.Governance.Query
                        Cardano.CLI.EraBased.Run.Governance.Vote
                        Cardano.CLI.EraBased.Run.Key
                        Cardano.CLI.EraBased.Run.Node
                        Cardano.CLI.EraBased.Run.Query
                        Cardano.CLI.EraBased.Run.StakeAddress
                        Cardano.CLI.EraBased.Run.StakePool
                        Cardano.CLI.EraBased.Run.TextView
                        Cardano.CLI.EraBased.Run.Transaction
                        Cardano.CLI.Helpers
                        Cardano.CLI.IO.GitRev
                        Cardano.CLI.IO.Lazy
                        Cardano.CLI.Json.Friendly
                        Cardano.CLI.Legacy.Commands
                        Cardano.CLI.Legacy.Commands.Address
                        Cardano.CLI.Legacy.Commands.Genesis
                        Cardano.CLI.Legacy.Commands.Governance
                        Cardano.CLI.Legacy.Commands.Key
                        Cardano.CLI.Legacy.Commands.Node
                        Cardano.CLI.Legacy.Commands.Query
                        Cardano.CLI.Legacy.Commands.StakeAddress
                        Cardano.CLI.Legacy.Commands.StakePool
                        Cardano.CLI.Legacy.Commands.TextView
                        Cardano.CLI.Legacy.Commands.Transaction
                        Cardano.CLI.Legacy.Options
                        Cardano.CLI.Legacy.Run
                        Cardano.CLI.Legacy.Run.Address
                        Cardano.CLI.Legacy.Run.Genesis
                        Cardano.CLI.Legacy.Run.Governance
                        Cardano.CLI.Legacy.Run.Key
                        Cardano.CLI.Legacy.Run.Node
                        Cardano.CLI.Legacy.Run.Query
                        Cardano.CLI.Legacy.Run.StakeAddress
                        Cardano.CLI.Legacy.Run.StakePool
                        Cardano.CLI.Legacy.Run.TextView
                        Cardano.CLI.Legacy.Run.Transaction
                        Cardano.CLI.Options
                        Cardano.CLI.OS.Posix
                        Cardano.CLI.Parser
                        Cardano.CLI.Pretty
                        Cardano.CLI.Read
                        Cardano.CLI.Render
                        Cardano.CLI.Run
                        Cardano.CLI.Run.Ping
                        Cardano.CLI.TopHandler
                        Cardano.CLI.Types.Common
                        Cardano.CLI.Types.Errors.AddressCmdError
                        Cardano.CLI.Types.Errors.AddressInfoError
                        Cardano.CLI.Types.Errors.BootstrapWitnessError
                        Cardano.CLI.Types.Errors.CardanoAddressSigningKeyConversionError
                        Cardano.CLI.Types.Errors.CmdError
                        Cardano.CLI.Types.Errors.DelegationError
                        Cardano.CLI.Types.Errors.GenesisCmdError
                        Cardano.CLI.Types.Errors.GovernanceActionsError
                        Cardano.CLI.Types.Errors.GovernanceCmdError
                        Cardano.CLI.Types.Errors.GovernanceCommitteeError
                        Cardano.CLI.Types.Errors.GovernanceQueryError
                        Cardano.CLI.Types.Errors.GovernanceVoteCmdError
                        Cardano.CLI.Types.Errors.ItnKeyConversionError
                        Cardano.CLI.Types.Errors.KeyCmdError
                        Cardano.CLI.Types.Errors.NodeCmdError
                        Cardano.CLI.Types.Errors.ProtocolParamsError
                        Cardano.CLI.Types.Errors.QueryCmdError
                        Cardano.CLI.Types.Errors.QueryCmdLocalStateQueryError
                        Cardano.CLI.Types.Errors.RegistrationError
                        Cardano.CLI.Types.Errors.ScriptDecodeError
                        Cardano.CLI.Types.Errors.StakeAddressCmdError
                        Cardano.CLI.Types.Errors.StakeAddressDelegationError
                        Cardano.CLI.Types.Errors.StakeAddressRegistrationError
                        Cardano.CLI.Types.Errors.StakeCredentialError
                        Cardano.CLI.Types.Errors.StakePoolCmdError
                        Cardano.CLI.Types.Errors.TextViewFileError
                        Cardano.CLI.Types.Errors.TxCmdError
                        Cardano.CLI.Types.Errors.TxValidationError
                        Cardano.CLI.Types.Governance
                        Cardano.CLI.Types.Key
                        Cardano.CLI.Types.Key.VerificationKey
                        Cardano.CLI.Types.Output
                        Cardano.CLI.Types.TxFeature

  other-modules:        Paths_cardano_cli
  autogen-modules:      Paths_cardano_cli

  build-depends:        aeson             >= 1.5.6.0
                      , aeson-pretty      >= 0.8.5
                      , ansi-terminal
                      , attoparsec
                      , base16-bytestring >= 1.0
                      , bech32            >= 1.1.0
                      , binary
                      , bytestring
                      , canonical-json
                      , cardano-api ^>= 8.25.2.0
                      , cardano-binary
                      , cardano-crypto
                      , cardano-crypto-class ^>= 2.1.2
                      , cardano-crypto-wrapper ^>= 1.5.1
                      , cardano-data >= 1.0
                      , cardano-git-rev
                      , cardano-ledger-alonzo >= 1.3.1.1
                      , cardano-ledger-binary >= 1.0
                      , cardano-ledger-byron >= 1.0.0.2
                      , cardano-ledger-conway >= 1.5
                      , cardano-ledger-core >= 1.2
                      , cardano-ledger-shelley >=1.4.1.0
                      , cardano-ping ^>= 0.2.0.5
                      , cardano-prelude
                      , cardano-slotting ^>= 0.1
                      , cardano-strict-containers ^>= 0.1
                      , cborg >= 0.2.4 && < 0.3
                      , containers
                      , contra-tracer
                      , cryptonite
                      , deepseq
                      , directory
                      , filepath
                      , formatting
                      , io-classes
                      , iproute
                      , mtl
                      , microlens
                      , network
                      , optparse-applicative-fork
                      , ouroboros-consensus >= 0.12
                      , ouroboros-consensus-cardano >= 0.10
                      , ouroboros-consensus-protocol >= 0.5.0.4
                      , ouroboros-network-api
                      , ouroboros-network-protocols
                      , parsec
                      , prettyprinter
                      , prettyprinter-ansi-terminal
                      , random
                      , split
                      , strict-stm
                      , text
                      , time
                      , transformers
                      , transformers-except ^>= 0.1.3
                      , unliftio-core
                      , utf8-string
                      , yaml

executable cardano-cli
  import:               project-config
  hs-source-dirs:       app
  main-is:              cardano-cli.hs
  ghc-options:          -threaded -rtsopts "-with-rtsopts=-T"

  build-depends:        cardano-cli
                      , cardano-crypto-class ^>= 2.1.2
                      , optparse-applicative-fork
                      , transformers-except

library cardano-cli-test-lib
  import:               project-config
  visibility:           public
  hs-source-dirs:       test/cardano-cli-test-lib
  exposed-modules:      Test.Cardano.CLI.Util
  build-depends:        aeson
                      , aeson-pretty
                      , bytestring
                      , cardano-api
                      , cardano-cli
                      , directory
                      , exceptions
                      , filepath
                      , hedgehog
                      , hedgehog-extras ^>= 0.4.7.0
                      , process
                      , text
                      , transformers

test-suite cardano-cli-test
  import:               project-config

  hs-source-dirs:       test/cardano-cli-test
  main-is:              cardano-cli-test.hs
  type:                 exitcode-stdio-1.0

  build-depends:        aeson
                      , base16-bytestring
                      , bech32 >= 1.1.0
                      , bytestring
                      , cardano-api:{cardano-api, internal}
                      , cardano-api-gen ^>= 8.2.0.0
                      , cardano-cli
                      , cardano-cli:cardano-cli-test-lib
                      , cardano-slotting
                      , containers
                      , filepath
                      , hedgehog
                      , hedgehog-extras ^>= 0.4.7.0
                      , parsec
                      , tasty
                      , tasty-hedgehog
                      , text
                      , time
                      , transformers

  build-tool-depends:   tasty-discover:tasty-discover

  other-modules:        Test.Cli.CliIntermediateFormat
                        Test.Cli.FilePermissions
                        Test.Cli.ITN
                        Test.Cli.JSON
                        Test.Cli.MultiAssetParsing
                        Test.Cli.Pioneers.Exercise1
                        Test.Cli.Pioneers.Exercise2
                        Test.Cli.Pioneers.Exercise3
                        Test.Cli.Pioneers.Exercise4
                        Test.Cli.Pioneers.Exercise5
                        Test.Cli.Pioneers.Exercise6
                        Test.Cli.Pipes
                        Test.Cli.Shelley.Run.Query

  ghc-options:          -threaded -rtsopts -with-rtsopts=-N -with-rtsopts=-T

test-suite cardano-cli-golden
  import:               project-config

  hs-source-dirs:       test/cardano-cli-golden
  main-is:              cardano-cli-golden.hs
  type:                 exitcode-stdio-1.0

  build-depends:        aeson >= 1.5.6.0
                      , base16-bytestring
                      , bytestring
                      , cardano-api:{cardano-api, gen}
                      , cardano-binary
                      , cardano-cli
                      , cardano-cli:cardano-cli-test-lib
                      , cardano-crypto-wrapper
                      , cardano-ledger-byron
                      , cborg
                      , containers
                      , filepath
                      , hedgehog ^>= 1.3
                      , hedgehog-extras ^>= 0.4.7.0
                      , regex-compat
                      , regex-tdfa
                      , tasty
                      , tasty-hedgehog
                      , text
                      , time
                      , transformers
                      , unordered-containers
  build-tool-depends:   cardano-cli:cardano-cli
                      , tasty-discover:tasty-discover

  other-modules:        Test.Golden.Byron.SigningKeys
                        Test.Golden.Byron.Tx
                        Test.Golden.Byron.TxBody
                        Test.Golden.Byron.UpdateProposal
                        Test.Golden.Byron.Vote
                        Test.Golden.Byron.Witness
                        Test.Golden.EraBased.Governance.AnswerPoll
                        Test.Golden.EraBased.Governance.CreatePoll
                        Test.Golden.EraBased.Governance.VerifyPoll
                        Test.Golden.ErrorsSpec
                        Test.Golden.Governance.Action
                        Test.Golden.Governance.Committee
                        Test.Golden.Governance.DRep
                        Test.Golden.Help
                        Test.Golden.Key.NonExtendedKey
                        Test.Golden.Shelley.Address.Build
                        Test.Golden.Shelley.Address.Info
                        Test.Golden.Shelley.Address.KeyGen
                        Test.Golden.Shelley.Genesis.Create
                        Test.Golden.Shelley.Genesis.InitialTxIn
                        Test.Golden.Shelley.Genesis.KeyGenDelegate
                        Test.Golden.Shelley.Genesis.KeyGenGenesis
                        Test.Golden.Shelley.Genesis.KeyGenUtxo
                        Test.Golden.Shelley.Genesis.KeyHash
                        Test.Golden.Shelley.Key.ConvertCardanoAddressKey
                        Test.Golden.Shelley.Metadata.StakePoolMetadata
                        Test.Golden.Shelley.MultiSig.Address
                        Test.Golden.Shelley.Node.IssueOpCert
                        Test.Golden.Shelley.Node.KeyGen
                        Test.Golden.Shelley.Node.KeyGenKes
                        Test.Golden.Shelley.Node.KeyGenVrf
                        Test.Golden.Shelley.StakeAddress.Build
                        Test.Golden.Shelley.StakeAddress.DeregistrationCertificate
                        Test.Golden.Shelley.StakeAddress.KeyGen
                        Test.Golden.Shelley.StakeAddress.RegistrationCertificate
                        Test.Golden.Shelley.StakePool.RegistrationCertificate
                        Test.Golden.Shelley.TextEnvelope.Certificates.GenesisKeyDelegation
                        Test.Golden.Shelley.TextEnvelope.Certificates.MIR
                        Test.Golden.Shelley.TextEnvelope.Certificates.Operational
                        Test.Golden.Shelley.TextEnvelope.Certificates.StakeAddress
                        Test.Golden.Shelley.TextEnvelope.Certificates.StakePool
                        Test.Golden.Shelley.TextEnvelope.Keys.ExtendedPaymentKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.GenesisDelegateKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.GenesisKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.GenesisUTxOKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.KESKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.PaymentKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.StakeKeys
                        Test.Golden.Shelley.TextEnvelope.Keys.VRFKeys
                        Test.Golden.Shelley.TextEnvelope.Tx.Tx
                        Test.Golden.Shelley.TextEnvelope.Tx.TxBody
                        Test.Golden.Shelley.TextEnvelope.Tx.Witness
                        Test.Golden.Shelley.TextView.DecodeCbor
                        Test.Golden.Shelley.Transaction.Assemble
                        Test.Golden.Shelley.Transaction.Build
                        Test.Golden.Shelley.Transaction.CalculateMinFee
                        Test.Golden.Shelley.Transaction.CreateWitness
                        Test.Golden.Shelley.Transaction.Sign
                        Test.Golden.TxView
                        Test.Golden.Version

  ghc-options:          -threaded -rtsopts -with-rtsopts=-N -with-rtsopts=-T
