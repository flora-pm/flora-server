cabal-version:   3.0
name:            ekg-core
version:         0.1.1.7.0.0.0.0.1
license:         BSD-3-Clause
license-file:    LICENSE
maintainer:
    Johan Tibell <johan.tibell@gmail.com>,
    Mikhail Glushenkov <mikhail.glushenkov@gmail.com>,
    operations@iohk.io

author:          Johan Tibell
tested-with:
    ghc ==8.4.4 || ==8.6.5 || ==8.8.4 || ==8.10.7 || ==9.2.8 || ==9.6.3 || ==9.8.1

homepage:        https://github.com/input-output-hk/ekg
bug-reports:     https://github.com/input-output-hk/ekg/issues
synopsis:        Tracking of system metrics
description:     This library lets you define and track system metrics.
category:        System
build-type:      Simple
extra-doc-files: CHANGELOG.md

source-repository head
    type:     git
    location: https://github.com/input-output-hk/ekg.git
    subdir:   ekg-core

library
    exposed-modules:
        System.Metrics
        System.Metrics.Counter
        System.Metrics.Distribution
        System.Metrics.Distribution.Internal
        System.Metrics.Gauge
        System.Metrics.Label

    c-sources:
        cbits/atomic.c
        cbits/distrib.c

    other-modules:
        Data.Array
        Data.Atomic
        System.Metrics.ThreadId

    default-language: Haskell2010
    include-dirs:     cbits
    includes:         distrib.h
    install-includes: distrib.h
    ghc-options:      -Wall
    build-depends:
        base >=4.6 && <4.20,
        containers >=0.5 && <0.7,
        ghc-prim >=0.5.2 && <0.12,
        text >=1.2.4 && <2.2,
        unordered-containers <0.3

    if arch(i386)
        cc-options: -march=i686

benchmark counter
    type:             exitcode-stdio-1.0
    main-is:          Counter.hs
    hs-source-dirs:   benchmarks
    default-language: Haskell2010
    ghc-options:      -O2 -threaded -Wall
    build-depends:
        base,
        ekg-core

benchmark distribution
    type:             exitcode-stdio-1.0
    main-is:          Distribution.hs
    hs-source-dirs:   benchmarks
    default-language: Haskell2010
    ghc-options:      -O2 -threaded -Wall
    build-depends:
        base,
        ekg-core
